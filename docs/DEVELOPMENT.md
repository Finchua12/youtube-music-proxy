# Посібник розробника YouTube Music Proxy

## Архітектура проекту

### Загальна структура

```
youtube-music/
├── backend/           # Python backend (FastAPI)
│   ├── src/           # Основний код
│   │   ├── main.py    # Точка входу FastAPI
│   │   ├── downloader.py  # Завантаження з YouTube
│   │   ├── cache.py   # Управління кешем
│   │   ├── db.py      # Робота з базою даних
│   │   ├── auth.py    # Аутентифікація
│   │   ├── youtube_api.py  # YouTube Data API
│   │   ├── recommendations.py  # Рекомендації
│   │   ├── config.py  # Управління конфігурацією
│   │   └── models.py  # Pydantic моделі
│   ├── tests/         # Тести backend
│   └── requirements.txt  # Залежності Python
├── frontend/          # Tauri frontend (Vue.js)
│   ├── src/           # Основний код frontend
│   │   ├── components/   # Компоненти Vue
│   │   ├── pages/        # Сторінки додатку
│   │   ├── styles/       # Стилі та теми
│   │   ├── main.ts       # Точка входу
│   │   └── App.vue       # Головний компонент
│   ├── tests/         # Тести frontend
│   └── package.json   # Залежності Node.js
├── src-tauri/         # Tauri конфігурація
│   ├── Cargo.toml     # Залежності Rust
│   └── src/main.rs    # Точка входу Tauri
├── docs/              # Документація
├── scripts/           # Скрипти збірки та розгортання
└── tests/             # Інтеграційні тести
```

## Backend (Python/FastAPI)

### Основні компоненти

#### 1. Основний сервер (main.py)

Точка входу FastAPI додатку, яка містить:
- Ініціалізацію сервісів
- Визначення маршрутів API
- Middleware конфігурацію
- Обробку помилок

#### 2. Завантажувач (downloader.py)

Відповідає за:
- Пошук відео через yt-dlp
- Завантаження аудіо з YouTube
- Конвертацію в MP3
- Обробку помилок завантаження

#### 3. Кеш (cache.py)

Управління локальним кешем:
- Зберігання завантажених аудіо файлів
- Обмеження розміру кешу
- Автоматичне очищення старих файлів
- Статистика використання

#### 4. База даних (db.py)

Робота з SQLite:
- Управління плейлистами
- Зберігання історії прослуховування
- Улюблені треки
- Налаштування користувача

#### 5. Аутентифікація (auth.py)

OAuth2 інтеграція з YouTube:
- Генерація авторизаційних URL
- Обробка callback-ів
- Управління токенами
- Перевірка автентифікації

#### 6. YouTube API (youtube_api.py)

Інтеграція з YouTube Data API v3:
- Пошук з покращеною інформацією
- Отримання деталей відео
- Робота з плейлистами користувача
- Улюблені відео

#### 7. Рекомендації (recommendations.py)

Генерація персоналізованих рекомендацій:
- На основі історії прослуховування
- За популярністю
- Для відкриття нової музики

#### 8. Конфігурація (config.py)

Управління налаштуваннями:
- Завантаження/збереження конфігурації
- Налаштування за замовчуванням
- Валідація параметрів

### Роути API

Всі роути знаходяться в `main.py` і включають:

- **Пошук**: `/api/search`
- **Завантаження**: `/api/download`
- **Стрімінг**: `/api/stream/{video_id}`
- **Плейлисти**: `/api/playlists/*`
- **Нещодавні**: `/api/recently-played`
- **Улюблені**: `/api/likes/*`
- **Рекомендації**: `/api/recommendations/*`
- **Кеш**: `/api/cache/*`
- **Аутентифікація**: `/api/auth/*`
- **Налаштування**: `/api/preferences/*`

### Моделі даних

Всі Pydantic моделі визначені в `models.py`:
- DownloadRequest/DownloadResponse
- SearchRequest/SearchResult
- Playlist/PlaylistItem
- RecentlyPlayedItem
- CacheStats
- Тощо

## Frontend (Vue.js/Tauri)

### Основні компоненти

#### 1. Головний додаток (App.vue)

- Верхня панель з навігацією
- Бічна панель меню
- Основна область вмісту
- Нижня панель програвача

#### 2. Сторінки

- **Home.vue**: Головна сторінка з рекомендаціями
- **Search.vue**: Пошук та результати
- **Library.vue**: Бібліотека користувача
- **Playlist.vue**: Деталі плейлиста

#### 3. Компоненти

- **Sidebar.vue**: Бічна панель навігації
- **PlayerBar.vue**: Нижня панель програвача
- **TrackItem.vue**: Елемент списку треків
- **PlaylistCard.vue**: Карточка плейлиста
- Тощо

### Стилі та теми

#### CSS змінні

Всі стилі використовують CSS змінні для легкої кастомізації тем:
- `--bg-primary`, `--bg-secondary`
- `--text-primary`, `--text-secondary`
- `--accent` (YouTube червоний)
- Темні та світлі теми

#### Адаптивність

- Mobile-first підхід
- Flexbox/Grid для розмітки
- Media queries для різних розмірів екранів

### Tauri інтеграція

#### Конфігурація

`tauri.conf.json` містить:
- Налаштування вікон
- Дозволи (allowlist)
- Пакування додатку
- System tray конфігурацію

#### API інтеграція

Використання Tauri API для:
- Управління вікнами
- Діалогові вікна
- Робота з файловою системою
- System tray
- Clipboard

## Розробка та тестування

### Середовище розробки

#### Backend

```bash
# Активація віртуального середовища
cd backend
python -m venv venv
source venv/bin/activate

# Встановлення залежностей
pip install -r requirements.txt

# Запуск сервера розробки
uvicorn src.main:app --reload
```

#### Frontend

```bash
# Встановлення залежностей
cd frontend
npm install

# Запуск розробки
npm run tauri:dev
```

### Тестування

#### Unit тести

Backend тести розміщені в `backend/tests/`:
```bash
cd backend
python -m pytest tests/
```

Frontend тести в `frontend/tests/`:
```bash
cd frontend
npm run test
```

#### Інтеграційні тести

Тести для всього додатку в `tests/`:
```bash
python -m pytest tests/integration/
```

### Linting та форматування

#### Backend

```bash
# Flake8 для лінтингу
flake8 src/

# Black для форматування
black src/
```

#### Frontend

```bash
# ESLint для лінтингу
npm run lint

# Prettier для форматування
npm run format
```

## Збірка та розгортання

### Збірка додатку

```bash
# Збірка для виробництва
cd frontend
npm run tauri:build
```

### CI/CD

GitHub Actions workflow в `.github/workflows/`:
- Автоматичні тести при кожному push
- Збірка додатку при релізах
- Публікація релізів

### Релізи

1. Оновити версію в `package.json` та `Cargo.toml`
2. Створити Git tag
3. Створити GitHub Release
4. Завантажити зібрані артефакти

## Додавання нових функцій

### 1. Планування

- Визначити вимоги
- Спроектувати API
- Створити технічне завдання

### 2. Реалізація

- Створити гілку для функції
- Реалізувати backend (якщо потрібно)
- Реалізувати frontend
- Додати тести
- Оновити документацію

### 3. Тестування

- Unit тести
- Інтеграційні тести
- Ручне тестування
- Перевірка сумісності

### 4. Реліз

- Code review
- Merge в main
- Створення релізу

## Найкращі практики

### Backend

- Використовуйте async/await для I/O операцій
- Обробляйте всі можливі помилки
- Використовуйте dependency injection
- Пишіть документацію до API
- Використовуйте логування

### Frontend

- Використовуйте Composition API
- Розділяйте логіку та представлення
- Оптимізуйте рендеринг списків
- Використовуйте lazy loading
- Дотримуйтесь принципів доступності

### Безпека

- Валідуйте всі вхідні дані
- Використовуйте HTTPS в продакшені
- Захищайте API endpoints
- Не зберігайте секрети в коді
- Використовуйте CORS правильно

### Продуктивність

- Кешуйте результати пошуку
- Оптимізуйте завантаження зображень
- Використовуйте пагінацію
- Мінімізуйте bundle size
- Використовуйте background tasks

## Debugging

### Backend

```bash
# Запуск з логами
uvicorn src.main:app --log-level debug

# Використання pdb
python -m pdb src/main.py
```

### Frontend

- Vue DevTools для інспектування компонентів
- Network tab для перевірки API запитів
- Console для логування

### Tauri

- Tauri debugger
- System logs
- Performance profiler

## Розширення функціональності

### Плагіни

Для додавання нових функцій створюйте плагіни:
- Виділяйте логіку в окремі модулі
- Використовуйте існуючу архітектуру
- Документуйте API плагіна

### Інтеграції

Для інтеграції з іншими сервісами:
- Використовуйте окремі модулі
- Додавайте налаштування
- Обробляйте помилки мережі

## Підтримка

### Версійність

Дотримуйтесь SemVer:
- MAJOR для breaking changes
- MINOR для нових функцій
- PATCH для bug fixes

### Документація

Оновлюйте документацію при кожній зміні:
- API документацію
- Посібник користувача
- Посібник розробника

### Community

- Відповідайте на issues
- Приймайте pull requests
- Підтримуйте дискусії
- Оновлюйте roadmap